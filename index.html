<!DOCTYPE html>
<html>
  <head>
    <title>dataURI vs src test</title>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js'></script>
    <script src='https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js'></script>
    <script src='jquery-globalize.js'></script>
    <script src='codebase.js'></script>
    <script src='codebase-dataURI.js'></script>
    <script id='testScript'></script>
    <style>
      .results {
        float: left;
        width: 12em;
        border: 1px solid greenyellow;
        padding: 2px 2px 2px 8px;
      }
    </style>
  </head>
  <body>
    <p>
      https://rawgithub.com/dfkaye/datauri-vs-src-test/master/index.html
    </p>
    <p>
      view the repo for this page at 
      <a href='https://github.com/dfkaye/datauri-vs-src-test'>
        https://github.com/dfkaye/datauri-vs-src-test
      </a>
    </p>
    
    <button type='button' data-method='scriptSrc'>load scriptSrc</button>
    <button type='button' data-method='dataURI'>load dataURI</button>
    <button type='button' data-method='scriptText'>load scriptText</button>
        
    <div>
      <div id='scriptSrcResults' class='results'></div>
      <div id='dataURIResults' class='results'></div>
      <div id='scriptTextResults' class='results'></div>
    </div>
    
    <script>
      ;(function() {
        
        // var dataURI defined in codebase-dataURI.js
        // codebase defined in codebase.js      
        var strategies = {
          'dataURI' : dataURI,
          'scriptSrc' : 'codebase.js',
          'scriptText' : codebase.toString()
        };
             
        var buttons = document.getElementsByTagName('button');
        
        for (var i = 0; i < buttons.length; ++i) {
        
          var btn = buttons[i];
          
          if (btn.addEventListener) {
            btn.addEventListener('click', onBtnClick, false);
          } else if (btn.attachEvent) {
            btn.attachEvent('onclick', onBtnClick, false);
          } else {
            btn.onclick = onBtnClick;
          }
        }
  
        function onBtnClick(e) {
        
          var target = e.target || e.srcElement || this;
          var method = target.getAttribute('data-method');
          var src = strategies[method];
          
          createScript(src, method);
        }
        
        function createScript(src, method) {
        
          var start = +new Date();
          var parentNode = removeScript();
          var script = document.createElement('script');
          
          script.id ='testScript';
  
          if (method === 'scriptText') {
          
            script.text = src;
            profile(start, method);
            
          } else {
            
            script.async = true;
            
            script.onload = script.onreadystatechange = function () {
              if (!script.readyState || script.readyState == 'loaded' || script.readyState == 'complete') {
                script.onload = script.onreadystatechange = null
                profile(start, method)
              }
            }
            
            script.src = src;
          }
          
          parentNode.appendChild(script);
        }
        
        function profile(start, method) {
          
          codebase();
          
          var end = +new Date();
          var results = document.getElementById(method + 'Results');
          
          results.innerHTML += (method + ' took ' + ((end - start) / 1000) + ' seconds.<br/>')
        }
        
        function removeScript() {
        
          var testScript = document.getElementById('testScript');
          var parentNode = testScript.parentNode;
                  
          parentNode.removeChild(testScript);
          
          return parentNode;
        }
        
      }());
    </script>
  </body>
</html>
