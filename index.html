<!DOCTYPE html>
<html>
  <head>
    <title>dataURI vs src test</title>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js'></script>
    <script src='https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js'></script>
    <script src='jquery-globalize.js'></script>
    <script src='codebase.js'></script>
    <script src='codebase-dataURI.js'></script>
    <script id='testScript'></script>
    <style>
      .results {
        float: left;
        width: 12em;
        border: 1px solid greenyellow;
        padding: 2px 2px 2px 8px;
      }
    </style>
  </head>
  <body>
    <p>
      https://rawgithub.com/dfkaye/datauri-vs-src-test/master/index.html
    </p>
    <p>
      view the repo for this page at 
      <a href='https://github.com/dfkaye/datauri-vs-src-test'>
        https://github.com/dfkaye/datauri-vs-src-test
      </a>
    </p>
    <button type='button' id='loadSrc' onclick='loadBySrc()'>load src</button>
    <button type='button' id='loadDataURI' onclick='loadByDataURI()'>load dataURI</button>
    <button type='button' id='loadScriptText' onclick='loadByScriptText()'>load ScriptText</button>
    
    <div>
      <div id='scriptSrcResults' class='results'></div>
      <div id='dataURIResults' class='results'></div>
      <div id='scriptTextResults' class='results'></div>
    </div>
    
    <script>
      // var dataURI defined in codebase-dataURI.js
      var scriptSrc = 'codebase.js';
      
      // codebase defined in codebase.js
      var scriptText = codebase.toString();
      
      function loadBySrc() {
        createScript(scriptSrc, 'scriptSrc')
      }
      
      function loadByDataURI() {
        createScript(dataURI, 'dataURI')
      }
      
      function loadByScriptText() {
        createScript(scriptText, 'scriptText')
      }
      
      function removeScript() {
      
        var testScript = document.getElementById('testScript');
        var parentNode = testScript.parentNode;
        
        codebase = null;
        
        parentNode.removeChild(testScript);
        
        return parentNode;
      }
      
      function createScript(src, type) {
      
        var start = +new Date();
        var parentNode = removeScript();
        var script = document.createElement('script');
        
        script.id ='testScript';

        if (type === 'scriptText') {
          script.text = src;
          profile(start, type);
          
        } else {
          
          script.async = true;
          
          script.onload = script.onreadystatechange = function () {
            if (!script.readyState || script.readyState == 'loaded' || script.readyState == 'complete') {
              script.onload = script.onreadystatechange = null
              profile(start, type)
            }
          }
          
          script.src = src;
        }
        
        parentNode.appendChild(script);
      }
      
      function profile(start, type) {
        
        codebase();
        
        var end = +new Date();
        var results = document.getElementById(type + 'Results');
        
        results.innerHTML += (type + ' took ' + ((end - start) / 1000) + ' seconds.<br/>')
      }
    </script>
  </body>
</html>
